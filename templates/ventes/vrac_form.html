{% extends "base.html" %}
{% block title %}Nouvelle Vente Vrac{% endblock %}
{% block content %}
<div class="container mt-4">
    <h1><i class="bi bi-droplet-fill"></i> Nouvelle Vente en Vrac</h1>
    
    <div class="alert alert-info mt-3">
        <strong>ℹ️ Vente en vrac :</strong> Vente de vin en volume (litres) directement depuis les cuves
    </div>
    
    <form method="post" class="mt-4">
        {% csrf_token %}
        
        <div class="mb-3">
            <label for="customer" class="form-label">Client *</label>
            <select name="customer" id="customer" class="form-select" required>
                <option value="">Sélectionner un client</option>
                {% for customer in customers %}
                <option value="{{ customer.id }}">{{ customer.legal_name }}</option>
                {% endfor %}
            </select>
            {% if not customers %}
            <div class="alert alert-danger mt-2">
                <i class="bi bi-exclamation-triangle"></i> Aucun client disponible. 
                <a href="{% url 'ventes:client_new' %}" class="alert-link">Créer un client</a>
            </div>
            {% endif %}
        </div>
        
        <div class="mb-3">
            <label for="lot" class="form-label">Lot (optionnel)</label>
            <select name="lot" id="lot" class="form-select">
                <option value="">Sélectionner un lot</option>
                {% for lot in lots %}
                <option value="{{ lot.id }}">{{ lot.code }} - {{ lot.cuvee.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="mb-3">
            <label for="volume_l" class="form-label">Volume (litres) *</label>
            <input type="number" name="volume_l" id="volume_l" class="form-control" 
                   placeholder="Ex: 1000" min="1" step="0.01" required>
        </div>
        
        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary" {% if not customers %}disabled{% endif %}>
                Créer la vente vrac
            </button>
            <a href="{% url 'ventes:vrac_list' %}" class="btn btn-secondary">Annuler</a>
        </div>
    </form>
</div>
{% endblock %}
