{% extends 'production/base_production.html' %}
{% load static %}

{% block title %}Catalogue produits - Mon Chai{% endblock %}

{% block production_content %}
<!-- Breadcrumb -->
<nav aria-label="breadcrumb" class="mb-3">
  <ol class="breadcrumb mb-0">
    <li class="breadcrumb-item"><a href="{% url 'production:production_home' %}" class="text-decoration-none">Production</a></li>
    <li class="breadcrumb-item active" aria-current="page">Catalogue</li>
  </ol>
</nav>

<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h4 mb-0">{{ page_title|default:'Catalogue produits' }}</h1>
    <p class="text-muted mb-0 small">Vins, produits dérivés et articles à la vente</p>
  </div>
  <a href="{% url 'produits:product_new' %}" class="btn btn-primary">
    <i class="bi bi-plus-lg me-1"></i>Nouveau produit
  </a>
</div>

<!-- Filtres -->
<div class="card mb-3">
  <div class="card-body py-2">
    <form method="get" class="row g-2 align-items-end">
      <div class="col-md-5">
        <input type="text" name="q" value="{{ q }}" placeholder="Rechercher par nom, marque..." class="form-control" />
      </div>
      <div class="col-md-3">
        <select name="type" class="form-select">
          <option value="">Type (tous)</option>
          <option value="wine" {% if type == 'wine' %}selected{% endif %}>Vin</option>
          <option value="food" {% if type == 'food' %}selected{% endif %}>Alimentaire</option>
          <option value="merch" {% if type == 'merch' %}selected{% endif %}>Merch</option>
          <option value="service" {% if type == 'service' %}selected{% endif %}>Service</option>
          <option value="other" {% if type == 'other' %}selected{% endif %}>Autre</option>
        </select>
      </div>
      <div class="col-md-2">
        <button class="btn btn-outline-primary w-100"><i class="bi bi-search me-1"></i>Filtrer</button>
      </div>
      <div class="col-md-2">
        <a href="{% url 'produits:catalog_list' %}" class="btn btn-outline-secondary w-100"><i class="bi bi-x-circle me-1"></i>Effacer</a>
      </div>
    </form>
  </div>
</div>

<!-- Tableau produits -->
<div class="card">
  <div class="table-responsive">
    <table class="table table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th>Nom</th>
          <th>Marque</th>
          <th>Type</th>
          <th>Cuvée</th>
          <th class="text-end">Prix</th>
          <th class="text-center">Actif</th>
        </tr>
      </thead>
      <tbody>
        {% for p in products %}
          <tr style="cursor: pointer;" onclick="window.location='{% url 'produits:product_detail' slug=p.slug %}'">
            <td>
              <strong>{{ p.name }}</strong>
            </td>
            <td>{{ p.brand|default:'—' }}</td>
            <td>
              <span class="badge {% if p.type_code == 'wine' %}bg-danger{% elif p.type_code == 'food' %}bg-warning text-dark{% elif p.type_code == 'service' %}bg-info{% else %}bg-secondary{% endif %}">
                {{ p.get_product_type_display|default:p.type_code }}
              </span>
            </td>
            <td>{{ p.cuvee.name|default:'—' }}</td>
            <td class="text-end">{% if p.price_eur_u %}{{ p.price_eur_u }} €{% else %}—{% endif %}</td>
            <td class="text-center">
              {% if p.is_active %}<i class="bi bi-check-circle text-success"></i>{% else %}<i class="bi bi-x-circle text-muted"></i>{% endif %}
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="6" class="text-center py-5 text-muted">
            <i class="bi bi-box-seam display-4 d-block mb-3 opacity-25"></i>
            Aucun produit dans le catalogue
          </td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% if products.has_other_pages %}
<div class="mt-3">
  {% include 'referentiels/partials/pagination.html' with page_obj=products %}
</div>
{% endif %}
{% endblock %}
