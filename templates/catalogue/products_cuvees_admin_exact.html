{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Cuvées | Mon Chai Administration{% endblock %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'admin/css/changelists.css' %}">
{% endblock %}

{% block content %}
<!-- Breadcrumbs EXACTEMENT comme admin -->
<nav aria-label="Fil d'Ariane">
<div class="breadcrumbs">
<a href="/admin/">Accueil</a>
&rsaquo; <a href="/catalogue/produits/">Gestion des produits</a>
&rsaquo; Cuvées
</div>
</nav>

<div class="main" id="main">
  <main id="content-start" class="content" tabindex="-1">
    <div id="content" class="">
      
      <h1>Sélectionnez l'objet Cuvée à changer</h1>
      
      <div id="content-main">
        <!-- Bouton Ajouter EXACTEMENT comme admin -->
        <ul class="object-tools">
          <li>
            <a href="{% url 'catalogue:cuvee_create' %}" class="addlink">
              Ajouter Cuvée
            </a>
          </li>
        </ul>
        
        <!-- Module changelist EXACTEMENT comme admin -->
        <div class="module filtered" id="changelist">
          <div class="changelist-form-container">
            
            <!-- Barre de recherche EXACTEMENT comme admin -->
            <div id="toolbar">
              <form id="changelist-search" method="get" role="search">
                <div>
                  <label for="searchbar"><img src="{% static 'admin/img/search.svg' %}" alt="Search"></label>
                  <input type="text" size="40" name="q" value="{{ request.GET.q|default:'' }}" id="searchbar">
                  <input type="submit" value="Recherche">
                </div>
              </form>
            </div>

            <!-- Formulaire principal EXACTEMENT comme admin -->
            <form id="changelist-form" method="post" novalidate>
              {% csrf_token %}
              
              <!-- Actions EXACTEMENT comme admin -->
              <div class="actions">
                <label>Action : 
                  <select name="action" required>
                    <option value="" selected>---------</option>
                    <option value="delete_selected">Supprimer les Cuvées sélectionnées</option>
                  </select>
                </label>
                <input type="hidden" name="select_across" value="0" class="select-across">
                <button type="submit" class="button" title="Exécuter l'action sélectionnée" name="index" value="0">Envoyer</button>
                <span class="action-counter" data-actions-icnt="{{ cuvees|length }}">0 sur {{ cuvees|length }} sélectionné</span>
              </div>

              <!-- Tableau des résultats EXACTEMENT comme admin -->
              <div class="results">
                <table id="result_list">
                  <thead>
                    <tr>
                      <th scope="col" class="action-checkbox-column">
                        <div class="text">
                          <span><input type="checkbox" id="action-toggle" aria-label="Sélectionner tous les objets de cette page en vue d'une action"></span>
                        </div>
                        <div class="clear"></div>
                      </th>
                      <th scope="col" class="sortable column-name">
                        <div class="text"><a href="?o=1">Nom</a></div>
                        <div class="clear"></div>
                      </th>
                      <th scope="col" class="sortable column-appellation">
                        <div class="text"><a href="?o=2">Appellation</a></div>
                        <div class="clear"></div>
                      </th>
                      <th scope="col" class="sortable column-vintage">
                        <div class="text"><a href="?o=3">Millésime</a></div>
                        <div class="clear"></div>
                      </th>
                      <th scope="col" class="sortable column-uom">
                        <div class="text"><a href="?o=4">UOM</a></div>
                        <div class="clear"></div>
                      </th>
                      <th scope="col" class="sortable column-lots_count">
                        <div class="text"><a href="?o=5">Lots</a></div>
                        <div class="clear"></div>
                      </th>
                      <th scope="col" class="sortable column-is_active">
                        <div class="text"><a href="?o=6">Is active</a></div>
                        <div class="clear"></div>
                      </th>
                      <th scope="col" class="sortable column-organization">
                        <div class="text"><a href="?o=7">Organisation</a></div>
                        <div class="clear"></div>
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for cuvee in cuvees %}
                    <tr>
                      <td class="action-checkbox">
                        <input type="checkbox" name="_selected_action" value="{{ cuvee.id }}" class="action-select" aria-label="Choisir cet objet pour une action - {{ cuvee.name }}">
                      </td>
                      <th class="field-name">
                        <a href="/admin/viticulture/cuvee/{{ cuvee.id }}/change/">{{ cuvee.name }}</a>
                      </th>
                      <td class="field-appellation">{{ cuvee.appellation.name|default:"-" }}</td>
                      <td class="field-vintage">{{ cuvee.vintage.year|default:"-" }}</td>
                      <td class="field-uom">{{ cuvee.default_uom.code|default:"-" }}</td>
                      <td class="field-lots_count">{{ cuvee.lots_count|default:"0" }}</td>
                      <td class="field-is_active">
                        {% if cuvee.is_active %}
                          <img src="{% static 'admin/img/icon-yes.svg' %}" alt="True">
                        {% else %}
                          <img src="{% static 'admin/img/icon-no.svg' %}" alt="False">
                        {% endif %}
                      </td>
                      <td class="field-organization nowrap">{{ cuvee.organization.name }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                      <td colspan="8">Aucune cuvée trouvée.</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>

              <!-- Pagination EXACTEMENT comme admin -->
              <p class="paginator">
                {{ cuvees|length }} Cuvée{{ cuvees|length|pluralize:"s" }}
              </p>

            </form>
          </div>
          
          <!-- Filtres latéraux EXACTEMENT comme admin -->
          <div id="changelist-filter">
            <h2>Filtre</h2>
            <div id="changelist-filter-extra-actions">
              <h3>
                <a href="?_facets=True" class="viewlink">Afficher les nombres</a>
              </h3>
            </div>
            
            <!-- Filtre par appellation -->
            <details data-filter-title="appellation" open>
              <summary>Par appellation</summary>
              <ul>
                <li class="selected">
                  <a href="?">Tout</a>
                </li>
                {% for appellation in appellations %}
                <li>
                  <a href="?appellation__id__exact={{ appellation.id }}">{{ appellation.name }}</a>
                </li>
                {% endfor %}
              </ul>
            </details>

            <!-- Filtre par millésime -->
            <details data-filter-title="vintage" open>
              <summary>Par millésime</summary>
              <ul>
                <li class="selected">
                  <a href="?">Tout</a>
                </li>
                {% for vintage in vintages %}
                <li>
                  <a href="?vintage__id__exact={{ vintage.id }}">{{ vintage.year }}</a>
                </li>
                {% endfor %}
              </ul>
            </details>

            <!-- Filtre par statut actif -->
            <details data-filter-title="is active" open>
              <summary>Par is active</summary>
              <ul>
                <li class="selected">
                  <a href="?">Tout</a>
                </li>
                <li>
                  <a href="?is_active__exact=1">Oui</a>
                </li>
                <li>
                  <a href="?is_active__exact=0">Non</a>
                </li>
              </ul>
            </details>

            <!-- Filtre par organisation -->
            <details data-filter-title="Organisation" open>
              <summary>Par Organisation</summary>
              <ul>
                <li class="selected">
                  <a href="?">Tout</a>
                </li>
                {% for org in organizations %}
                <li>
                  <a href="?organization__id__exact={{ org.id }}">{{ org.name }}</a>
                </li>
                {% endfor %}
              </ul>
            </details>

          </div>
        </div>
      </div>
      
      <br class="clear">
    </div>
  </main>
</div>
{% endblock %}
