{% extends 'production/base_production.html' %}
{% block title %}Assemblage – Étape 2{% endblock %}
{% block production_content %}
<h1 class="h4 mb-3">Assemblage – Étape 2/3: Répartition</h1>
{% if error %}<div class="alert alert-danger">{{ error }}</div>{% endif %}
<form method="post" action="/production/assemblages/nouveau/">
  {% csrf_token %}
  <input type="hidden" name="step" value="2">
  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <thead>
        <tr>
          <th>Lot</th>
          <th>Volume disponible (L)</th>
          <th>Volume affecté (L)</th>
        </tr>
      </thead>
      <tbody>
        {% for s in sources %}
        <tr>
          <td>
            <input type="hidden" name="source_id" value="{{ s.id }}">
            {{ s.code }} — {{ s.cuvee.nom|default:'—' }} ({{ s.campagne }})
          </td>
          <td>{{ s.volume_net_calculated }}</td>
          <td>
            <input type="number" step="0.01" min="0" name="volume_l" class="form-control" placeholder="0.00">
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="mt-3 d-flex gap-2">
    <a href="{{ request.META.HTTP_REFERER|default:'/production/assemblages/nouveau/?step=1' }}" class="btn btn-secondary">Retour</a>
    <button class="btn btn-primary" type="submit">Continuer</button>
  </div>
</form>
{% endblock %}
