{% extends 'production/base_production.html' %}
{% block title %}Chai - Mon Chai{% endblock %}
{% block production_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h4 mb-0 fw-bold">Chai & Vinification</h1>
    <div class="btn-group">
        <a href="{% url 'production:lots_tech_list' %}" class="btn btn-outline-secondary">Tous les lots</a>
        <a href="{% url 'production:encuvages_list' %}" class="btn btn-primary">Encuvages & Suivi</a>
    </div>
</div>

<!-- KPIs -->
<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm">
            <div class="card-body">
                <div class="text-muted small text-uppercase fw-bold mb-2">Volume en fermentation</div>
                <div class="fs-3 fw-bold text-primary">{{ fermentation_vol_hl|default:0|floatformat:1 }} <small class="text-muted fs-6 fw-normal">hL</small></div>
                <div class="small text-muted mt-2">Lots en FA/FML</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm">
            <div class="card-body">
                <div class="text-muted small text-uppercase fw-bold mb-2">Cuves actives</div>
                <div class="fs-3 fw-bold text-dark">{{ fermentation_count|default:"0" }}</div>
            </div>
        </div>
    </div>
     <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm">
            <div class="card-body">
                <div class="text-muted small text-uppercase fw-bold mb-2">Encuvages Campagne</div>
                <div class="fs-3 fw-bold text-dark">{{ encuvages_count|default:"0" }}</div>
            </div>
        </div>
    </div>
</div>

<!-- Liste rapide -->
<div class="card border-0 shadow-sm">
    <div class="card-header bg-transparent py-3 border-0 d-flex justify-content-between align-items-center">
        <h6 class="mb-0 fw-bold">Lots récents</h6>
        <a href="{% url 'production:lots_tech_list' %}" class="text-decoration-none small">Voir tout</a>
    </div>
    <div class="table-responsive">
        <table class="table align-middle mb-0">
            <thead class="bg-light text-muted small">
                <tr>
                    <th class="ps-3 border-0">Code</th>
                    <th class="border-0">Volume</th>
                    <th class="border-0">Statut</th>
                    <th class="border-0">Contenant</th>
                    <th class="text-end pe-3 border-0"></th>
                </tr>
            </thead>
            <tbody>
                {% for lot in latest_lots %}
                <tr style="cursor: pointer;" onclick="window.location='{% url 'production:lot_tech_detail' lot.id %}'" class="table-hover">
                    <td class="ps-3 fw-medium">{{ lot.code }}</td>
                    <td class="font-monospace">{{ lot.volume_l|floatformat:0 }} L</td>
                    <td><span class="badge bg-light text-dark border">{{ lot.get_statut_display }}</span></td>
                    <td>{{ lot.contenant|default:"-" }}</td>
                    <td class="text-end pe-3"><a href="{% url 'production:lot_tech_detail' lot.id %}" class="btn btn-sm btn-light border">Voir</a></td>
                </tr>
                {% empty %}
                <tr><td colspan="5" class="text-center py-4 text-muted">Aucun lot créé récemment.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Navigation rapide -->
<h6 class="mt-4 mb-3 fw-bold text-muted small text-uppercase">Accès rapide</h6>
<div class="row g-3">
    <div class="col-md-3">
        <a href="{% url 'production:encuvages_list' %}" class="card h-100 text-decoration-none border-0 shadow-sm hover-shadow transition-all">
            <div class="card-body text-center p-3">
                <i class="bi bi-bucket text-primary fs-3 mb-2 d-block"></i>
                <span class="fw-bold text-dark">Encuvages</span>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a href="{% url 'production:soutirages_list' %}" class="card h-100 text-decoration-none border-0 shadow-sm hover-shadow transition-all">
            <div class="card-body text-center p-3">
                <i class="bi bi-arrow-left-right text-primary fs-3 mb-2 d-block"></i>
                <span class="fw-bold text-dark">Soutirages</span>
            </div>
        </a>
    </div>
</div>
{% endblock %}
