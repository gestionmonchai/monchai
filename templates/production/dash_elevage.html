{% extends 'production/base_production.html' %}
{% block title %}Suivi & Élevage - Mon Chai{% endblock %}
{% block production_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h4 mb-0 fw-bold">Suivi & Élevage</h1>
    <a href="{% url 'production:analyses_home' %}" class="btn btn-outline-primary">Saisir Analyses</a>
</div>

<div class="row g-3 mb-4">
    <div class="col-md-6 col-lg-3">
        <div class="card h-100 border-0 shadow-sm">
            <div class="card-body">
                <div class="text-muted small text-uppercase fw-bold mb-2">Volume en élevage</div>
                <div class="fs-3 fw-bold text-success">{{ elevage_vol_hl|default:0|floatformat:1 }} <small class="text-muted fs-6 fw-normal">hL</small></div>
                <div class="small text-muted mt-2">Lots stabilisés ou prêts</div>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-lg-3">
        <div class="card h-100 border-0 shadow-sm">
            <div class="card-body">
                <div class="text-muted small text-uppercase fw-bold mb-2">Lots concernés</div>
                <div class="fs-3 fw-bold text-dark">{{ elevage_count|default:"0" }}</div>
            </div>
        </div>
    </div>
</div>

<!-- Lots actifs -->
<div class="card border-0 shadow-sm mb-4">
    <div class="card-header bg-transparent py-3 border-0 d-flex justify-content-between align-items-center">
        <h6 class="mb-0 fw-bold">Lots en élevage (récents)</h6>
        <a href="{% url 'production:lots_elevage_home' %}" class="small text-decoration-none">Voir tout</a>
    </div>
    <div class="table-responsive">
        <table class="table align-middle mb-0">
            <thead class="bg-light text-muted small">
                <tr>
                    <th class="ps-3 border-0">Code</th>
                    <th class="border-0">Volume</th>
                    <th class="border-0">Contenant</th>
                    <th class="border-0">Dernière activité</th>
                    <th class="text-end pe-3 border-0"></th>
                </tr>
            </thead>
            <tbody>
                {% for lot in active_lots %}
                <tr style="cursor: pointer;" onclick="window.location='{% url 'production:lot_tech_detail' lot.id %}'" class="table-hover">
                    <td class="ps-3 fw-medium">{{ lot.code }}</td>
                    <td class="font-monospace">{{ lot.volume_l|default:0|floatformat:0 }} L</td>
                    <td>{{ lot.contenant|default:"-" }}</td>
                    <td class="text-muted small">{{ lot.updated_at|date:"d/m/Y" }}</td>
                    <td class="text-end pe-3"><a href="{% url 'production:lot_tech_detail' lot.id %}" class="btn btn-sm btn-light border">Voir</a></td>
                </tr>
                {% empty %}
                <tr><td colspan="5" class="text-center py-4 text-muted">Aucun lot en élevage.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Raccourcis -->
<div class="row g-3">
    <div class="col-md-4">
        <a href="{% url 'production:contenants_list' %}" class="card h-100 text-decoration-none border-0 shadow-sm hover-shadow transition-all">
            <div class="card-body text-center p-4">
                <i class="bi bi-box-seam text-primary fs-3 mb-2 d-block"></i>
                <span class="fw-bold text-dark">Cuves & barriques</span>
                <p class="small text-muted mb-0 mt-2">Parc barriques, cuves, amphores</p>
            </div>
        </a>
    </div>
</div>
{% endblock %}
