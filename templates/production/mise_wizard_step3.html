{% extends 'production/base_production.html' %}
{% load static %}
{% block title %}Nouvelle mise — Confirmation{% endblock %}
{% block production_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-1"><i class="bi bi-box-seam me-2 text-primary"></i>Nouvelle mise — Confirmation</h1>
        <p class="text-muted mb-0">Vérifiez les informations et validez</p>
    </div>
    <a href="?step=2" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i>Retour étape 2
    </a>
</div>

<div class="row g-3">
  <div class="col-lg-8">
    <!-- Récapitulatif -->
    <div class="card mb-3">
      <div class="card-header bg-primary bg-opacity-10">
        <i class="bi bi-clipboard-check me-2"></i>Récapitulatif de la mise
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-4">
            <div class="small text-muted">Volume total</div>
            <div class="h5 mb-0">{{ recap_volume|default:"0.00" }} L</div>
          </div>
          <div class="col-md-4">
            <div class="small text-muted">Nombre de bouteilles</div>
            <div class="h5 mb-0">{{ recap_qty|default:"0" }} unités</div>
          </div>
          <div class="col-md-4">
            <div class="small text-muted">Formats</div>
            <div class="h5 mb-0">{{ recap_formats|default:"—" }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Coûts (optionnel) -->
    <div class="card mb-3">
      <div class="card-header">
        <i class="bi bi-currency-euro me-2"></i>Coûts <span class="badge bg-secondary">Optionnel</span>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Coût main d'œuvre (€)</label>
            <input id="mo-eur" type="number" step="0.01" class="form-control" placeholder="0.00" name="mo_eur">
          </div>
          <div class="col-md-6">
            <label class="form-label">Notes</label>
            <input type="text" name="notes" class="form-control" placeholder="Notes optionnelles">
          </div>
        </div>
      </div>
    </div>

    <!-- Validation simplifiée -->
    <div class="card border-success">
      <div class="card-body">
        <form method="post" id="form-final">
          {% csrf_token %}
          <input type="hidden" name="step" value="3">
          <div class="d-flex justify-content-between align-items-center">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="chk-confirm" name="confirmer">
              <label class="form-check-label" for="chk-confirm">
                <strong>Je confirme la création de cette mise</strong>
              </label>
            </div>
            <button id="btn-submit" class="btn btn-success btn-lg" disabled>
              <i class="bi bi-check-circle me-2"></i>Créer la mise
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <!-- Aide -->
    <div class="card">
      <div class="card-header">Informations</div>
      <div class="card-body small">
        <p class="mb-2"><i class="bi bi-info-circle text-primary me-1"></i>Cette action va :</p>
        <ul class="mb-0">
          <li>Créer un ordre de mise (OF)</li>
          <li>Débiter le volume des lots sources</li>
          <li>Créer les lots commerciaux</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  const btnSubmit = document.getElementById('btn-submit');
  const chkConfirm = document.getElementById('chk-confirm');

  // Activer le bouton quand checkbox cochée
  chkConfirm.addEventListener('change', function(){
    btnSubmit.disabled = !this.checked;
  });
})();
</script>
{% endblock %}
