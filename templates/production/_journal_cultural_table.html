{% load humanize %}
<div class="d-none" id="journal-table-meta" data-total="{{ interventions_count }}"></div>
{% if interventions %}
<div class="table-responsive">
<table class="table table-hover mb-0">
    <thead class="table-light">
        <tr>
            <th style="width: 100px;">Date</th>
            <th>Parcelle</th>
            <th>Type</th>
            <th>Résumé</th>
            <th class="text-end" style="width: 100px;">Coût</th>
            <th style="width: 130px;">Saisi le</th>
            <th style="width: 50px;"></th>
        </tr>
    </thead>
    <tbody>
        {% for i in interventions %}
        <tr class="journal-row" style="cursor: pointer;" 
            onclick="window.location='{{ i.url }}'">
            <td class="text-nowrap">{{ i.date|date:"d/m/Y" }}</td>
            <td>
                <strong>{{ i.parcelle_nom }}</strong>
            </td>
            <td>
                <span class="badge 
                    {% if i.type == 'taille' %}bg-success
                    {% elif i.type == 'traitement' %}bg-warning text-dark
                    {% elif i.type == 'palissage' %}bg-info
                    {% elif i.type == 'travail_sol' %}bg-secondary
                    {% elif i.type == 'effeuillage' %}bg-success
                    {% elif i.type == 'fertilisation' %}bg-dark
                    {% elif i.type == 'irrigation' %}bg-info
                    {% else %}bg-light text-dark border{% endif %}">
                    {{ i.type_label }}
                </span>
            </td>
            <td>
                {{ i.resume|default:"—"|truncatewords:15 }}
                {% if i.notes %}<small class="text-muted d-block">{{ i.notes|truncatewords:10 }}</small>{% endif %}
            </td>
            <td class="text-end">
                {% if i.cout_total %}{{ i.cout_total|floatformat:2 }} €{% else %}—{% endif %}
            </td>
            <td class="text-muted small text-nowrap">
                {{ i.created_at|date:"d/m/Y H:i" }}
            </td>
            <td class="text-center">
                <i class="bi bi-box-arrow-up-right text-primary" title="Ouvrir l'événement"></i>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="7" class="text-center py-5 text-muted">
                <i class="bi bi-search me-2"></i>Aucune intervention trouvée
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
{% else %}
<div class="card-body text-center py-5">
    <div class="mb-3">
        <i class="bi bi-calendar-x text-muted display-1"></i>
    </div>
    <h5 class="text-muted">Aucune intervention enregistrée</h5>
    <p class="text-muted mb-4">
        Commencez par créer une parcelle, puis enregistrez vos interventions : taille, travaux en vert, travail du sol…
    </p>
    <div class="d-flex justify-content-center gap-2">
        <a href="{% url 'production:parcelles_list' %}" class="btn btn-outline-success">
            <i class="bi bi-map me-1"></i>Voir les parcelles
        </a>
    </div>
</div>
{% endif %}
