{% load static production_tags %}
{% get_alerts_count as alerts_total %}
{% get_alerts_urgent_count as alerts_urgent %}
{% get_overdue_alerts_count as alerts_overdue %}
{% get_lots_total_count as lots_total %}

<div class="card shadow-sm mb-4 border-0">
    <!-- HEADER PRODUCTION - Bordeaux -->
    <div class="card-header border-0 py-2" style="background: linear-gradient(135deg, #8B1538 0%, #722f37 100%);">
        <div class="d-flex justify-content-between align-items-center">
            <!-- Logo + Titre -->
            <div class="d-flex align-items-center gap-2">
                <div class="bg-white bg-opacity-10 rounded-2 p-1 d-flex align-items-center justify-content-center" style="width: 28px; height: 28px;">
                    <i class="bi bi-grid-3x3-gap-fill text-white"></i>
                </div>
                <span class="sidebar-label text-white fw-semibold" style="font-size: 0.9rem;">Production</span>
            </div>
            
            <!-- Actions: Alertes + Toggle -->
            <div class="d-flex align-items-center gap-2">
                {% if alerts_total %}
                <a href="{% url 'production:alerts_list' %}" class="text-decoration-none" title="{{ alerts_total }} alerte{{ alerts_total|pluralize }}">
                    <span class="badge rounded-pill {% if alerts_overdue %}bg-danger{% elif alerts_urgent %}bg-warning text-dark{% else %}bg-light text-dark{% endif %}" style="font-size: 0.65rem;">
                        <i class="bi bi-bell-fill me-1"></i>{{ alerts_total }}
                    </span>
                </a>
                {% endif %}
                <button class="btn btn-sm btn-link text-white text-decoration-none p-0 d-none d-lg-block" id="btnToggleSidebarDesktop" title="Réduire/Déplier le menu">
                    <i class="bi bi-chevron-left" id="desktopChevron"></i>
                </button>
                <button class="btn btn-sm btn-link text-white text-decoration-none p-0 d-lg-none" id="btnToggleSidebarMobile" title="Afficher/Masquer le menu">
                    <i class="bi bi-chevron-down" id="mobileMenuChevron"></i>
                </button>
            </div>
        </div>
    </div>
    
    <div class="list-group list-group-flush">

        <!-- Tableau de bord -->
        <a href="{% url 'production:production_home' %}" class="list-group-item list-group-item-action {% if request.resolver_match.url_name == 'production_home' %}active{% endif %}">
            <i class="bi bi-speedometer2 me-2"></i><span class="sidebar-label">Vue d'ensemble</span>
        </a>

        <!-- VIGNE -->
        <div class="sidebar-section-header list-group-item bg-light fw-bold text-uppercase small py-1 mt-2" style="color: #198754;">
            <span class="sidebar-label"><i class="bi bi-tree me-1"></i>Vigne</span>
        </div>
        
        <a href="{% url 'production:parcelles_list' %}" class="list-group-item list-group-item-action {% if 'parcelles' in request.path %}active{% endif %}">
            <i class="bi bi-map me-2"></i><span class="sidebar-label">Parcelles</span>
        </a>
        <a href="{% url 'production:journal_cultural' %}" class="list-group-item list-group-item-action {% if 'journal-cultural' in request.path %}active{% endif %}">
            <i class="bi bi-journal-text me-2"></i><span class="sidebar-label">Journal cultural</span>
        </a>

        <!-- VENDANGES -->
        <div class="sidebar-section-header list-group-item bg-light fw-bold text-uppercase small py-1 mt-2" style="color: #c2410c;">
            <span class="sidebar-label"><i class="bi bi-basket me-1"></i>Vendanges</span>
        </div>
        
        <a href="{% url 'production:vendanges_list' %}" class="list-group-item list-group-item-action {% if request.resolver_match.url_name == 'vendanges_list' %}active{% endif %}">
            <i class="bi bi-list-ul me-2"></i><span class="sidebar-label">Liste vendanges</span>
        </a>
        <a href="{% url 'production:encuvages_list' %}" class="list-group-item list-group-item-action {% if 'encuvage' in request.path %}active{% endif %}">
            <i class="bi bi-box-arrow-in-down me-2"></i><span class="sidebar-label">Encuvages</span>
        </a>

        <!-- CHAI -->
        <div class="sidebar-section-header list-group-item bg-light fw-bold text-uppercase small py-1 mt-2" style="color: #722f37;">
            <span class="sidebar-label"><i class="bi bi-boxes me-1"></i>Chai</span>
            {% if lots_total %}<span class="badge bg-secondary bg-opacity-25 text-secondary ms-1" style="font-size: 0.6rem;">{{ lots_total }}</span>{% endif %}
        </div>
        
        <a href="{% url 'production:lots_tech_list' %}" class="list-group-item list-group-item-action {% if 'lots-techniques' in request.path %}active{% endif %}">
            <i class="bi bi-box-seam me-2"></i><span class="sidebar-label">Lots techniques</span>
        </a>
        <a href="{% url 'production:vinification_home' %}" class="list-group-item list-group-item-action {% if 'vinification' in request.path %}active{% endif %}">
            <i class="bi bi-journal-code me-2"></i><span class="sidebar-label">Journal opérations</span>
        </a>
        <a href="{% url 'production:contenants_list' %}" class="list-group-item list-group-item-action {% if 'contenant' in request.path %}active{% endif %}">
            <i class="bi bi-archive me-2"></i><span class="sidebar-label">Cuves & barriques</span>
        </a>
        <a href="{% url 'production:assemblages_list' %}" class="list-group-item list-group-item-action {% if 'assemblage' in request.path %}active{% endif %}">
            <i class="bi bi-layers me-2"></i><span class="sidebar-label">Assemblages</span>
        </a>
        <a href="{% url 'production:soutirages_list' %}" class="list-group-item list-group-item-action {% if 'soutirage' in request.path %}active{% endif %}">
            <i class="bi bi-arrow-down-up me-2"></i><span class="sidebar-label">Soutirages</span>
        </a>

        <!-- ANALYSES -->
        <div class="sidebar-section-header list-group-item bg-light fw-bold text-uppercase small py-1 mt-2" style="color: #be185d;">
            <span class="sidebar-label"><i class="bi bi-droplet me-1"></i>Analyses</span>
        </div>
        
        <a href="{% url 'production:analyses_oeno_list' %}" class="list-group-item list-group-item-action {% if 'analyses' in request.path %}active{% endif %}">
            <i class="bi bi-clipboard-pulse me-2"></i><span class="sidebar-label">Analyses œnologiques</span>
        </a>

        <!-- CONDITIONNEMENT -->
        <div class="sidebar-section-header list-group-item bg-light fw-bold text-uppercase small py-1 mt-2" style="color: #20c997;">
            <span class="sidebar-label"><i class="bi bi-box2 me-1"></i>Conditionnement</span>
        </div>
        
        <a href="{% url 'production:mises_list' %}" class="list-group-item list-group-item-action {% if 'mises' in request.path %}active{% endif %}">
            <i class="bi bi-upc-scan me-2"></i><span class="sidebar-label">Mises en bouteille</span>
        </a>
        <a href="{% url 'production:inventaire' %}" class="list-group-item list-group-item-action {% if 'inventaire' in request.path %}active{% endif %}">
            <i class="bi bi-clipboard-data me-2"></i><span class="sidebar-label">Inventaire</span>
        </a>

        <!-- REGISTRES -->
        <div class="sidebar-section-header list-group-item bg-light fw-bold text-uppercase small py-1 mt-2" style="color: #6c757d;">
            <span class="sidebar-label"><i class="bi bi-journal-bookmark me-1"></i>Registres</span>
        </div>
        
        <a href="{% url 'production:registres_home' %}" class="list-group-item list-group-item-action {% if 'registres' in request.path %}active{% endif %}">
            <i class="bi bi-journal-bookmark me-2"></i><span class="sidebar-label">Registres officiels</span>
        </a>

    </div>
</div>
